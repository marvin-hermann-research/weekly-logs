# Weekly Log – 2025-08-17

## Summary of Activities

### 11.08
- Continued debugging – discovered issues with **YAML path handling**  
  - Not a problem in the code itself, but in the way relative paths were specified inside the YAML files  
  - **Fix:** converted relative paths to absolute paths at runtime  
  - Required two YAML adjustments and corresponding updates in the master post documentation  
- Investigated why the behavior tree seemed to hang in the start node  
  - **Hypothesis:** `can_walk` condition not being evaluated properly  
  - **Root cause:** action nodes (`idle`, `walking`) were incorrectly switching between `RUNNING` and `SUCCESS` instead of returning only `RUNNING` for non-terminating loops  
  - **Fix:** ensured action nodes return `RUNNING` correctly, preventing false switching  
- Expanded understanding of **blackboard storage**:  
  - Each behavior tree should maintain its **own blackboard instance**  
  - Adjusted architecture: when initializing the robot system, a dedicated blackboard is created and passed to all classes that read or write onto it  
  - Master document updated with this best practice  

### 12.08
- Achieved **major progress in tree debugging** 
  - **Issue:** tree was incorrectly structured  
    - Original design: selector first checked `idle`, which always returned valid → causing the selector to never evaluate later conditions  
    - **Fix:** restructured into:  
      - Sequence: `can_walk → may_walk → walk sequence`  
      - Fallback: `idle action node`  
  - Correct architecture ensures the tree evaluates walk conditions properly before defaulting to idle  
- Debugged `can_walk` condition often evaluating to `false`  
  - **Root cause:** laser sensor threshold set too restrictively  
  - **Fix:** adjusted threshold, restoring expected functionality  
- Result: **full system operational**  
  - Behavior tree now correctly controls sensors and actions  
  - Actions can be triggered automatically or enforced manually via console  
  - Movement controller successfully sends commands to the legs  
  - Entire simulation running as intended
- Created GitHub issues and began drafting the README for project documentation  

---

## Key Insights

- YAML path handling must be carefully designed for runtime context, converting relative paths to absolute paths at runtime avoids fragile configurations  
- Non-terminating actions (e.g., idle, walking loops) should always return `RUNNING` to prevent inconsistent switching states  
- Each behavior tree benefits from its **own blackboard instance** to ensure clean separation of state and avoid unintended overwrites  
- Selector-node structure matters: incorrect ordering can cause permanent blocking and prevent later checks from executing  

---

## Challenges & Fixes

- **YAML path misconfiguration**  
  ✔ **Fix:** convert relative paths to absolute at runtime and update YAML definitions  

- **Action nodes switching incorrectly between states**  
  ✔ **Fix:** ensured idle/walking loops only return `RUNNING`  

- **Blackboard storage confusion**  
  ✔ **Fix:** introduced dedicated blackboard per tree and updated documentation  

- **Tree stuck in idle state**  
  ✔ **Fix:** corrected selector/sequence structure with proper fallback design  

- **Unexpected `can_walk` failures**  
  ✔ **Fix:** adjusted laser sensor threshold  

---

## Next Steps

- Focus on implementing **scientific logging** across the system  
- Begin integration of **ROS2 with ESP32 hardware** (“the hardware wedding”)  
- Essential milestone for upcoming **application at Mairo**  
- After stabilization:  
  - Finalize README and improve project documentation  
  - Conduct further tests with sensor/actuator simulation to validate robustness  

---

## Reflection

This week’s progress was slowed due to **three exams**, leading to a delay in project schedule.  
Despite this, achieving a **fully operational simulation** marks a significant breakthrough.  
The next focus will be on structured logging and hardware integration to align with application requirements.
